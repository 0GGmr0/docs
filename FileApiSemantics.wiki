= File API call semantics = 

Note: This is a working draft, and may be incomplete or incorrect in some places.

----
[[TOC(inline)]]
----

[[BR]]
== Introduction and Purpose ==
----

This page is designed to specify, in detail, the behavior of File API calls under various circumstances.  For each call a list of argument and behavioral semantics is provided, along with a snippet of test code that shows how each case is verified -- hopefully in much the same style as the NetworkApiSemantics page.


----



[[BR]]
== fobj.close() ==
----

=== Interacts with: ===

All fobj methods that require a file to be open.

=== Argument Semantics: ===

None.

=== Behavioral Semantics: ===

1

Action: Close is called on an open file object.

Result: The file obj is closed. Read and write operations can no longer be performed.

(tested - fobj_close_basic.py)
Test Snippet:

{{{
fobj = open(filename)
fobj.close()
try:
  fobj.read(1)
except:
  pass
else:
  test_fail()
}}}

2

Action: Close is called on an allready closed file object.

Result: False is returned, no exception occurs.

(tested - fobj_close_duplicate.py)

Test Snippet:

{{{
fobj = open(filename)
fobj.close()
fobj.close()
}}}

3

Action: Close is called and the attempts are made to read or write from the file.

Result: An exception occurs.

(tested under other file_object methods)

----
[[BR]]
== fobj.flush() ==
----

=== Interacts with: ===

All fobj methods that write data into a file.

=== Argument Semantics: ===

None.

=== Behavioral Semantics: ===

1

Action: flush is called on a file object in read-only mode
Result: noop
(tested - file_obj_flush_read_only.py)

Test Snippet:

{{{
fobj = open(filename,'r')
fobj.flush()
}}}

2

Action: flush is called on a file object that has write capability
Result: Buffers are written to disk.
(tested - file_obj_flush_write.py)

Test Snippet:

{{{
fobj = open(filename,mode)
fobj.write(num)
fobj.flush()
reader = open(filename,'r')
if reader.read(1) != num:
  print ' write did not flush to disk on mode: '+mode
}}}

----
[[BR]]
== fobj.next() ==
----

=== Interacts With: ===

fobj.close()
fobj.read()
fobj.readline()
fobj.readlines()

=== Argument Semantics: ===

None.

=== Behavioral Semantics: ===

1

Action: next() is called on a file object that is opened for writing.

Result: IOError is raised.

Test Snippet:

{{{
fobj = open(filename, 'r+')
try:
  fobj.next()
except IOError:
  pass
else:
  fail('Supposed to throw exception!')
}}}

2

Action: next is called on a file object to get each line of the file, then next is called one additional time.

Result: Each line of the file is returned. When the additional call to next is made an exception is thrown.
(tested - fobj_next_forloop.py)

Test Snippet:

{{{
fobj = open(filename)
for line in fobj:
  #process each line
  try:
    fobj.next()
  except:
    pass
  else:
    fail('no exception')
}}}

3

Action: A fileobj is used as its own iterator in a for loop.

Result: Each line of the file is returned. An additional call to next outside of the for loop results in an exception.
(tested - fobj_next_linebyline.py)

Test Snippet:

{{{
fobj = open(filename)
for i in range(FILE_LENGTH):
  line = fobj.next()
  #process each line
  try:
    fobj.next()
  except:
    pass
  else:
    fail('no exception')
}}}

----
[[BR]]
== fobj.read(*args) ==
----

=== Interacts With: ===

fobj.close()
fobj.next()
fobj.readline()
fobj.readlines()

=== Argument Semantics: ===

Takes one argument (length to read). If that argument is omitted or a negative integer, read() returns the entire contents of the file from wherever the file handle is currently in the file. If that argument is a positive integer, read() returns at most that many bytes from the current position of the file handle. If the argument is not an integer, read() throws TypeError.

=== Behavioral Semantics: ===

Note: read() expects the file to be open; all test snippets after this assume the file has not had close() called on it yet.

1

Action: read() is called on a file object that is newly opened with no argument or a negative argument.

Result: The contents of the file are returned.

Test Snippet:

{{{
fobj = open(filename, 'rb')
fobj.read()
fobj.seek(0)
fobj.read(-1)
}}}

2

Action: read() is called with a positive 'len' argument.

Result: At most that many bytes of the file's contents are returned.

Test Snippet:

{{{
fobj = open(filename, 'rb)
str = fobj.read(5)
if len(str) > 5:
  fail("fobj.read() should read no more than len bytes!")
}}}

3

Action: read() is called with a len argument that is not an integer at all.

Result: TypeError is raised.

Test Snippet:

{{{
fobj = open(filename, 'rb')
for arg in [3.0, "hi"]:
  try:
    fobj.read(arg)
  except TypeError:
    pass
  else:
    fail("fobj.read() should raise TypeError when given a bad len argument")
}}}

----
[[BR]]
== fobj.readline(*args) ==
----

=== Interacts With: ===

TODO.

=== Argument Semantics: ===

TODO.

=== Behavioral Semantics: ===

TODO.

----
[[BR]]
== fobj.readlines(*args) ==
----

=== Interacts With: ===

TODO.

=== Argument Semantics: ===

TODO.

=== Behavioral Semantics: ===

TODO.

----
[[BR]]
== fobj.write(text) ==
----

=== Interacts With: ===

TODO.

=== Argument Semantics: ===

TODO.

=== Behavioral Semantics: ===

TODO.

----
[[BR]]
== fobj.writelines(lines) ==
----

=== Interacts With: ===

TODO.

=== Argument Semantics: ===

TODO.

=== Behavioral Semantics: ===

TODO.