= State Transition Daemons =

The state transition daemons track node configuration state. Primarily they are responsible for configuring a new Seattle installation for use by the GENI. 

----
[[TOC(inline)]]
----

== Overview ==
----

Each state transition daemon is a python script that runs '''all the time'''. These scripts are essential because they configure newly installed Seattle nodes for use by the GENI. Each script ''transitions'' the node from some prior state to a new state. The transition might require sending commands to the node manager, creating new database records, etc. Here are the three state transition scripts that run on seattlegeni.cs:

 * '''donationtocanonical''' -- transition a node from a newly installed state (donation state) into the canonical state
 * '''canonicaltoonepercent''' -- transitions a node from the canonical state into the one percent state in which the node is ready to be used by GENI
 * '''onepercenttoonepercent''' -- transitions a node from the one percent state back into the one percent state, updating some time-dependent information about the node in the database

[[BR]]
== Configuration ==
----

The state transition scripts on seattlegeni.cs are deployed in /home/geni/node_state_transitions/

[[BR]]
== Deploying the daemons ==
----

''Note: This information is slightly out of date. See #564 for more info on deploying the node state transition scripts.''

To deploy the state transition scripts into /home/geni/node_state_transitions/ from the Seattle trunk that is assumed to have been checked out in ~/trunk/, do the following ('''warning''' : the destination directory will be overwritten) :

{{{
$ export PYTHONPATH=$PYTHONPATH:~/trunk/ && deploy_state_transitions.py /home/geni/node_state_transitions/
}}}

[[BR]]
== Starting/Stopping the daemons ==
----

The daemons are run from the command line without any arguments. You must run them from within their directory (e.g. /home/geni/node_state_transitions/). Here is the command for running each of the different type of transition scripts:

 * donationtocanonical:

{{{
$ python donationtocanonical.py
}}}

 * canonicaltoonepercent:

{{{
$ python canonicaltoonepercent_manyevents.py
}}}

 * onepercenttoonepercent:

{{{
$ python onepercenttoonepercent_manyevents.py
}}}

[[BR]]
== Making sure that the daemons are running ==
----

To test if these scripts are running, you can run the following command and check that each of the transition scripts listed above appears in the output:

{{{
$ ps auwx | grep python | grep -v grep
}}}